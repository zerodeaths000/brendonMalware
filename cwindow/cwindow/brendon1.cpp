#include <Windows.h>

HBITMAP hBrendon1; //Image to display

LRESULT messageResult; //Result of SendMessageW();
LRESULT result; //Result of callback fuction

int randPosX;
int randPosY;

void loadImages(); //Function declaration
void paintImage();  //Function declaration
void moveWindow(); //Function declaration

HWND hImageWindow; //Windows
LRESULT CALLBACK wc_callback(HWND, UINT, WPARAM, LPARAM); //Callback function declaration

int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrev, LPSTR args, int ncmdshow) { //Main function (entry point)

	//MAIN WINDOW CLASS
	WNDCLASSW wc = {}; //Creating window class
	wc.hInstance = hInstance; //Instance of class
	wc.lpszClassName = L"mainClass"; //Name of class
	wc.lpfnWndProc = wc_callback; //Assigning callback function to class

	RegisterClassW(&wc); //Registering class

	hImageWindow = CreateWindowW(wc.lpszClassName, NULL, WS_VISIBLE | SS_BITMAP, 100, 100, 450, 450, NULL, NULL, NULL, NULL); //Creating main window
	SetWindowLong(hImageWindow, GWL_STYLE, 0); //Disabling styles
	ShowWindow(hImageWindow, SW_SHOW); //Showing window with no header
	//MAIN WINDOW CLASS

	MSG msg; //Making message variable
	while (GetMessage(&msg, NULL, NULL, NULL)) {
		TranslateMessage(&msg);
		DispatchMessageW(&msg);
	}
}

LRESULT CALLBACK wc_callback(HWND hImageWindow, UINT msg, WPARAM wp, LPARAM lp) { //Callback function
	switch (msg) {
		case WM_CREATE: {
			loadImages(); //loading images
			return 0; //Returning so window can continiue to create
		}
		case WM_PAINT: {
			paintImage();
			break;
		}
		case WM_DESTROY: {
			PostQuitMessage(0); //If user hits X, app colses
			break; //Break
		}
		default: {
			paintImage(); 
			moveWindow();
			return result = DefWindowProcW(hImageWindow, msg, wp, lp); //Window loop
		}
	}
	return result; //returning result in case
}

void loadImages() {
	LPCWSTR fileToLoad = L"./brendon1.bmp"; //declaring file to load
	hBrendon1 = (HBITMAP)LoadImageW(NULL, fileToLoad, (WPARAM)IMAGE_BITMAP, 0, 0, LR_LOADFROMFILE); //Assigning bitmap
	//Error check
	if (hBrendon1 == NULL) {
		DWORD error = GetLastError();
		LPTSTR output = NULL;
		FormatMessage(FORMAT_MESSAGE_FROM_SYSTEM | FORMAT_MESSAGE_ALLOCATE_BUFFER | FORMAT_MESSAGE_IGNORE_INSERTS, NULL, error, MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), (LPTSTR)&output, 0, NULL);
		MessageBox(NULL, output, L"Error. Reason:", MB_OK);
	}
	//Error check
}

void paintImage() {
	PAINTSTRUCT ps; //Declaring paintstruct
	HDC hdc; //Declaring HDC
	HDC hdcMem; //Declaring HDC
	BITMAP rBitmap; //Declaring regular bitmap
	HGDIOBJ oBitmap; //Getting old bitmap

	hdc = BeginPaint(hImageWindow, &ps); //Beginning paint
	hdcMem = CreateCompatibleDC(hdc); //Creating dc
	oBitmap = SelectObject(hdcMem, hBrendon1); //Assigning value to old bitmap

	GetObject(hBrendon1, sizeof(rBitmap), &rBitmap); //I have no idea what this does I just copied this
	BitBlt(hdc, 0, -50, rBitmap.bmWidth, rBitmap.bmHeight, hdcMem, 0, 0, SRCCOPY); //Blitting image to window

	SelectObject(hdcMem, oBitmap); //No idea either
	DeleteDC(hdcMem); //Deleting hdcMem's value

	EndPaint(hImageWindow, &ps); //Finishing paint
}

void moveWindow() {
	randPosX = rand() % 1470 + 1; //Make random x position
	randPosY = rand() % 630 + 1; //Make random y position

	MoveWindow(hImageWindow, randPosX, randPosY, 450, 450, false); //Move the window

	Sleep(250); //Waiting
}