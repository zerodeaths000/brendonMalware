#include <Windows.h>

HBITMAP hBrendon1; //Image to display

LRESULT messageResult; //Result of SendMessageW();
LRESULT result; //Result of callback fuction

void loadImages(); //Function declaration
void ImageWindows();//Function declaration
void CheckWindowNull();

HWND hImageWindow; //Windows
LRESULT CALLBACK wc_callback(HWND, UINT, WPARAM, LPARAM); //Callback function declaration

int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrev, LPSTR args, int ncmdshow) { //Main function (entry point)

	//MAIN WINDOW CLASS
	WNDCLASSW wc = {}; //Creating window class
	wc.hInstance = hInstance; //Instance of class
	wc.lpszClassName = L"mainClass"; //Name of class
	wc.lpfnWndProc = wc_callback; //Assigning callback function to class

	RegisterClassW(&wc); //Registering class

	hImageWindow = CreateWindowW(wc.lpszClassName, NULL, WS_VISIBLE | SS_BITMAP, 100, 100, 517, 450, NULL, NULL, NULL, NULL); //Creating main window
	//MAIN WINDOW CLASS

	MSG msg; //Making message variable
	while (GetMessage(&msg, NULL, NULL, NULL)) {
		TranslateMessage(&msg);
		DispatchMessageW(&msg);
	}
}

LRESULT CALLBACK wc_callback(HWND hImageWindow, UINT msg, WPARAM wp, LPARAM lp) { //Callback function
	switch (msg) {
		case WM_CREATE: {
			loadImages(); //loading images
			ImageWindows(); //Sending image to window
			return 0; //Returning so window can continiue to create
		}
		case WM_DESTROY: {
			PostQuitMessage(0); //If user hits X, app colses
			break; //Break
		}
		default: {
			ImageWindows();
			return result = DefWindowProcW(hImageWindow, msg, wp, lp); //Window loop
		}
	}
	return result; //returning result in case
}

void loadImages() {
	LPCWSTR fileToLoad = L"./brendon1.bmp"; //declaring file to load
	hBrendon1 = (HBITMAP)LoadImageW(NULL, fileToLoad, (WPARAM)IMAGE_BITMAP, 0, 0, LR_LOADFROMFILE); //Assigning bitmap
	//Error check
	if (hBrendon1 == NULL) {
		DWORD error = GetLastError();
		LPTSTR output = NULL;
		FormatMessage(FORMAT_MESSAGE_FROM_SYSTEM | FORMAT_MESSAGE_ALLOCATE_BUFFER | FORMAT_MESSAGE_IGNORE_INSERTS, NULL, error, MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), (LPTSTR)&output, 0, NULL);
		MessageBox(NULL, output, L"Error. Reason:", MB_OK);
	}
	else {
		MessageBox(NULL, L"Image was found successfully!", L"Success!", MB_OK);
	}
	//Error check
}

void ImageWindows() {
	messageResult = SendMessageW(hImageWindow, STM_SETIMAGE, IMAGE_BITMAP, (LPARAM)hBrendon1); //sending image to window
	//Error check
	if (messageResult == NULL) {
		DWORD error = GetLastError();
		LPTSTR output = NULL;
		FormatMessage(FORMAT_MESSAGE_FROM_SYSTEM | FORMAT_MESSAGE_ALLOCATE_BUFFER | FORMAT_MESSAGE_IGNORE_INSERTS, NULL, error, MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), (LPTSTR)&output, 0, NULL);
		MessageBox(NULL, output, L"Error. Reason:", MB_OK);
	}
	else {
		MessageBox(NULL, L"Image was assigned correctly!", L"Success", MB_OK);
	}
	//Error check
}

void CheckWindowNull() {
	if (hImageWindow == NULL) {
		MessageBox(NULL, L"Error, window is null", L"Error", MB_OK);
	}
	else {
		MessageBox(NULL, L"hImageWindow is not null.", L"No errors!", MB_OK);
	}
}